<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<meta name="theme-color" content="#0f1224"/>
<title>ヒントの町 – ポップシティ v0.6.3</title>
<style>
  :root{ --bg1:#0f1224; --bg2:#15193a; --ink:#e6e7ff; --pane:rgba(255,255,255,.08); --pane2:rgba(255,255,255,.12); }
  html,body{height:100%;margin:0;background:linear-gradient(180deg,var(--bg1),var(--bg2));color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,Noto Sans JP,Helvetica,Arial}
  .wrap{display:grid;place-items:center;height:100%;gap:16px}
  .hud{position:absolute;left:12px;top:12px;font-size:14px;line-height:1.4;pointer-events:none;text-shadow:0 1px 0 rgba(0,0,0,.35)}
  .hud h1{margin:0 0 8px;font-size:20px}
  .pill{display:inline-block;background:var(--pane);border:1px solid var(--pane2);padding:3px 8px;border-radius:999px;margin-right:8px}
  canvas{border-radius:18px;box-shadow:0 10px 30px rgba(0,0,0,.4), inset 0 0 0 1px rgba(255,255,255,.08);touch-action:none}
  details.legend{position:absolute;right:12px;top:12px;background:var(--pane);border:1px solid var(--pane2);border-radius:12px;padding:6px 10px;font-size:12px;max-width:300px}
  details.legend[open]{background:rgba(255,255,255,.1)}
  details.legend summary{cursor:pointer;list-style:none;user-select:none}
  .legend-body div{display:flex;gap:8px;align-items:center;margin:4px 0}
  .panel{position:absolute;left:50%;bottom:12px;transform:translateX(-50%);display:grid;gap:10px;justify-items:center}
  .held{display:grid;grid-auto-flow:column;gap:10px;align-items:center;background:var(--pane);border:1px solid var(--pane2);backdrop-filter:blur(8px);padding:8px 12px;border-radius:14px}
  .btn{pointer-events:all;cursor:pointer;display:inline-flex;align-items:center;gap:8px;border:1px solid rgba(255,255,255,.18);
    background:linear-gradient(180deg,rgba(255,255,255,.12),rgba(255,255,255,.06));padding:6px 10px;border-radius:12px;color:#fff;text-decoration:none;font-weight:700;font-size:12px}
  .zoomBtns{position:absolute;right:12px;bottom:12px;display:grid;gap:8px}
  /* === 追加：スマホ最適化＆レイヤ順 === */
.hud{ z-index:4; }                 /* 文字は前面だが操作は邪魔しない */
details.legend{ z-index:5; pointer-events:auto; } /* タップ可能に */
canvas{ z-index:1; }

/* ヘルプを小さく＆幅を抑える */
details.legend{ max-width: 80vw; }
@media (max-width: 480px){
  .hud{ font-size:12px; }
  details.legend{ right:8px; top:8px; font-size:11px; max-width: 72vw; }
  .panel{ gap:8px }
  .btn{ padding:6px 10px; font-size:11px }
}
</style>
</head>
<body>
<div class="wrap">
  <canvas id="game" width="960" height="600" aria-label="game"></canvas>

  <div class="hud">
    <h1>ヒントの町 v0.6.3 <span class="pill">タップ: 拾う/与える</span><span class="pill">ピンチ: ズーム</span><span class="pill">2本指ドラッグ: パン</span></h1>
    <div id="status"></div>
  </div>

  <details class="legend" id="legendWrap" open>
    <summary>ℹ️ ヘルプ（タップで開閉）</summary>
    <div id="legend" class="legend-body"></div>
  </details>

  <div class="panel">
    <div class="held">選択中：<span id="heldIcon">なし</span>
      <button class="btn" id="dropBtn">捨てる</button>
      <button class="btn" id="resetBtn">リセット</button>
    </div>
  </div>

  <div class="zoomBtns">
    <button class="btn" id="zin">＋</button>
    <button class="btn" id="zout">－</button>
  </div>
</div>

<!-- SWキルスイッチ（?killsw=1でSW解除→自動再読込） -->
<script>
(() => {
  const qs = new URLSearchParams(location.search);
  if (qs.get('killsw') === '1' && 'serviceWorker' in navigator) {
    navigator.serviceWorker.getRegistrations().then(rs => {
      rs.forEach(r => r.unregister());
      location.replace(location.origin + location.pathname + '?nocache=' + Date.now());
    });
  }
})();
</script>

<!-- スクリプト群（順番厳守） -->
<script src="./config.js?v=perf9"></script>
<script src="./city.js?v=perf9"></script>
<script src="./entities.js?v=perf9"></script>
<!-- <script src="./input.js?v=perf9"></script>  ← ここはいったん外す or コメントアウト -->
<script src="./main.js?v=perf9"></script>

<!-- ビルド確認用（今読んだ版が必ず表示されます） -->
<script>document.getElementById('status').insertAdjacentHTML('beforeend',' / build: <b>perf9</b>');</script>
</body>
</html>
